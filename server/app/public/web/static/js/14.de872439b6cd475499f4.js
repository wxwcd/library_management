webpackJsonp([14],{bK1j:function(e,a,r){"use strict";Object.defineProperty(a,"__esModule",{value:!0});var t=r("Xxa5"),s=r.n(t),o=r("exGp"),n=r.n(o),i=r("Dd8w"),l=r.n(i),c=r("0jG4"),u={name:"BorrowBook",mixins:[r("9WlX").a],props:{modal:Object},watch:{"modal.show":{handler:function(){if(this.modal.show&&this.modal.row){this.modal.row.isAdmin=this.modal.row.isAdmin+"";var e=this.modal.row,a=e.category,r=e.press;return this.params=l()({},this.params,this.modal.row,{category:a?a._id:"",press:r?r._id:""})}this.modal.row=null},immediate:!0}},data:function(){return{params:this.initData(),categoryList:[],pressList:[],loading:!1,users:[],userId:"",rules:{userId:{type:"string",required:!0,message:"必填项"},_id:{type:"string",required:!0,message:"必填项"},borrowStatus:{type:"string",required:!0,message:"必填项"}}}},created:function(){this.getCategoryAll(),this.getPressAll()},methods:{initData:function(){return{_id:void 0,name:"",category:"",press:"",author:"",stock:"",desc:"",borrowStatus:"0",userId:""}},remoteMethod:function(e){var a=this;return n()(s.a.mark(function r(){var t,o;return s.a.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(""===e){r.next=14;break}return a.loading=!0,r.prev=2,r.next=5,c.e.get({name:e,pageNo:1,size:20});case 5:t=r.sent,o=t.data,a.loading=!1,a.users=o.rows||[],r.next=14;break;case 11:r.prev=11,r.t0=r.catch(2),a.loading=!1;case 14:case"end":return r.stop()}},r,a,[[2,11]])}))()},modalOk:function(){var e=this;return n()(s.a.mark(function a(){return s.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,e.$refs.form.validate();case 2:if(a.sent){a.next=5;break}return a.abrupt("return");case 5:if(1==e.params.borrowStatus){a.next=10;break}return a.next=8,e.borrow();case 8:a.next=12;break;case 10:return a.next=12,e.book();case 12:e.$Message.success("提交成功！"),e.initModal("ok");case 14:case"end":return a.stop()}},a,e)}))()},borrow:function(){var e=this;return n()(s.a.mark(function a(){var r;return s.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,c.a.borrow(e.$QS.stringify({_id:e.params._id,borrowStatus:1,userId:e.params.userId}));case 2:r=a.sent,r.data;case 4:case"end":return a.stop()}},a,e)}))()},book:function(){var e=this;return n()(s.a.mark(function a(){var r;return s.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,c.a.borrow(e.$QS.stringify({_id:e.params._id,borrowStatus:0,userId:e.params.userId}));case 2:r=a.sent,r.data;case 4:case"end":return a.stop()}},a,e)}))()},cancel:function(){this.initModal("cancel")},initModal:function(e){this.params=this.initData(),this.modal.show=!1,this.$refs.form.resetFields(),this.$emit(e)}}},d={render:function(){var e=this,a=e.$createElement,r=e._self._c||a;return r("Modal",{attrs:{id:"borrow",top:"5%",width:"500",title:1==e.params.borrowStatus?"还书":"借书"},on:{"on-ok":e.modalOk,"on-cancel":e.cancel},model:{value:e.modal.show,callback:function(a){e.$set(e.modal,"show",a)},expression:"modal.show"}},[r("div",{staticClass:"modal-form"},[r("Form",{ref:"form",attrs:{model:e.params,rules:e.rules,labelWidth:80}},[r("FormItem",{attrs:{label:"读者",prop:"userId"}},[r("Select",{attrs:{clearable:"",filterable:"",remote:"","remote-method":e.remoteMethod,loading:e.loading},model:{value:e.params.userId,callback:function(a){e.$set(e.params,"userId",a)},expression:"params.userId"}},e._l(e.users,function(a,t){return r("Option",{key:a._id,attrs:{value:a._id}},[e._v(e._s(a.name))])}))],1),e._v(" "),r("FormItem",{attrs:{label:"书名",prop:"name"}},[r("Input",{attrs:{disabled:"",placeholder:"请输入书名"},model:{value:e.params.name,callback:function(a){e.$set(e.params,"name",a)},expression:"params.name"}})],1),e._v(" "),r("FormItem",{attrs:{label:"类别",prop:"category"}},[r("Select",{attrs:{disabled:"",filterable:""},model:{value:e.params.category,callback:function(a){e.$set(e.params,"category",a)},expression:"params.category"}},e._l(e.categoryList,function(a){return r("Option",{key:a._id,attrs:{value:a._id}},[e._v(e._s(a.name))])}))],1),e._v(" "),r("FormItem",{attrs:{label:"出版社",prop:"press"}},[r("Select",{attrs:{disabled:"",filterable:""},model:{value:e.params.press,callback:function(a){e.$set(e.params,"press",a)},expression:"params.press"}},e._l(e.pressList,function(a){return r("Option",{key:a._id,attrs:{value:a._id}},[e._v(e._s(a.name))])}))],1),e._v(" "),r("FormItem",{attrs:{label:"作者",prop:"author"}},[r("Input",{attrs:{disabled:"",placeholder:"请输入作者"},model:{value:e.params.author,callback:function(a){e.$set(e.params,"author",a)},expression:"params.author"}})],1),e._v(" "),r("FormItem",{attrs:{label:"简介",prop:"desc"}},[r("Input",{attrs:{disabled:"",type:"textarea",rows:6,placeholder:"简介"},model:{value:e.params.desc,callback:function(a){e.$set(e.params,"desc",a)},expression:"params.desc"}})],1)],1)],1),e._v(" "),r("div",{attrs:{slot:"footer"},slot:"footer"},[r("Button",{attrs:{type:"primary"},on:{click:e.modalOk}},[e._v(e._s(1==e.params.borrowStatus?"确认还书":"确认借出"))]),e._v(" "),r("Button",{attrs:{type:"ghost"},on:{click:e.cancel}},[e._v("取消")])],1)])},staticRenderFns:[]};var m=r("VU/8")(u,d,!1,function(e){r("xDsk")},null,null);a.default=m.exports},xDsk:function(e,a){}});